
@model IEnumerable<room_reservation.ViewModel.PermissionViewModel>

<div class="block mb-4">
    <div class="block-header border-bottom px-4 py-3">
        <h5 class="m-0">إدارة الصلاحيات</h5>
        <div class="d-flex gap-2">
            <div class="form-group">
                <input id="search" type="text" class="form-control table__quick_search"
                       placeholder="البحث السريع ...">
            </div>

            <a class="btn btn-primary" href="@Url.Action("AddPermission", "Permission")">إضافة صلاحية</a>
            <!-- Add Section Modal -->
            <div class="modal fade" id="add_section" tabindex="-1"
                 aria-labelledby="add_sectionLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="block-body">
        <table id="datatable" class="table table-hover js-dataTable">
            <thead>
                <tr>
                    <th>البريد الإلكتروني</th>
                    <th>المبنى</th>
                    <th>رقم المبنى</th>
                    <th>الصلاحية</th>
                    
                </tr>
            </thead>
            <tbody id="table-body">
               
                @{
                    foreach (var data in Model)
                    {
                        <tr>
                            <td>@data.Email</td>
                            <td>@data.BuildingName</td>
                            <td>@(data.BuildingNum == 0 ? "غير محدد" : data.BuildingNum.ToString())</td>
                            <td>@data.RoleName</td>
                            <td>
                                <a asp-area="Admin" asp-controller="Permission" asp-action="EditPermission" asp-route-guid="@data.Guid" class="btn btn-success">تعديل</a>
                                <a onclick="confirmDelete('guid-value')" data-id="guid-value" class="btn btn-danger delete-btn">حذف</a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

 @section Scripts{
    <script>
        $(document).ready(function () {
            function search() {
                var searchInput = $('#search').val().toLowerCase();
                $('#table-body tr').each(function () {
                    var emailCell = $(this).find('td').first().text().toLowerCase();
                    if (emailCell.indexOf(searchInput) > -1) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            }

            $('#search').on('input', search);


        // Delete confirmation
            $('.delete-btn').on('click', function (event) {
                event.preventDefault();

                var id = $(this).data('id');

                swal({
                    title: "هل أنت متأكد؟",
                    text: "",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "نعم، احذف!",
                    cancelButtonText: "إلغاء"
                }, function (isConfirm) {
                    if (isConfirm) {
                        $.ajax({
                            url: '@Url.Action("DeletePermission")',
                            type: 'POST',
                            data: { guid: id },
                            success: function (response) {
                                if (response.success) {
                                    swal(
                                        'نجحت العملية!',
                                        'حُذِفت الصلاحية.',
                                        'success'
                                    ).then(() => {
                                        location.reload();
                                    });
                                } else {
                                    swal(
                                        'فشلت العملية!',
                                        'لم تُحذف الصلاحية.',
                                        'error'
                                    );
                                }
                            },
                            error: function () {
                                swal(
                                    'خطأ!',
                                    'حدث خطأ غير متوقع.',
                                    'error'
                                );
                            }
                        });
                    }
                });
            });
        });
</script>